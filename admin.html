<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - ที่นี่บึงกาฬ</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #8B5CF6;
            --secondary-color: #A855F7;
            --accent-color: #C084FC;
            --dark-purple: #6B46C1;
            --light-purple: #F3E8FF;
            --text-color: #2C3E50;
            --light-gray: #F8F9FA;
            --medium-gray: #E9ECEF;
            --dark-gray: #495057;
            --white: #fff;
            --black: #000;
            --gradient-primary: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);
            --gradient-secondary: linear-gradient(135deg, #6B46C1 0%, #8B5CF6 100%);
            --shadow-light: 0 2px 10px rgba(139, 92, 246, 0.1);
            --shadow-medium: 0 4px 20px rgba(139, 92, 246, 0.15);
            --shadow-purple: 0 8px 32px rgba(139, 92, 246, 0.2);
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: var(--light-gray);
            min-height: 100vh;
        }

        .admin-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .admin-header h1 {
            margin: 0 0 10px 0;
            color: white;
        }

        .admin-header p {
            margin: 0;
            opacity: 0.9;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-purple);
        }

        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow-light);
            text-align: center;
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-purple);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .stat-icon {
            font-size: 2em;
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .messages-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow-light);
        }

        .messages-section h2 {
            color: var(--dark-gray);
            margin-bottom: 20px;
        }

        .message-item {
            border-bottom: 1px solid var(--light-gray);
            padding: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .message-content {
            flex: 1;
        }

        .message-meta {
            font-size: 0.9em;
            color: var(--dark-gray);
            margin-bottom: 5px;
        }

        .message-text {
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .message-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 5px 15px;
            font-size: 0.8em;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-new {
            background: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7em;
        }

        .status-read {
            background: #27ae60;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7em;
        }

        .login-form {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: var(--shadow-medium);
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark-gray);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            font-family: 'Kanit', sans-serif;
            box-sizing: border-box;
            color: var(--text-color);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .login-submit-btn {
            width: 100%;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--dark-gray);
        }

        .empty-state i {
            font-size: 3em;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .hidden {
            display: none !important;
        }

        .admin-panel-hidden {
            display: none;
        }

        /* Additional Styles for New Features */
        .admin-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow-light);
            margin-bottom: 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-header h2 {
            color: var(--dark-gray);
            margin: 0;
        }

        .section-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-actions {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow-light);
            margin-top: 20px;
        }

        .quick-actions h3 {
            color: var(--dark-gray);
            margin-bottom: 15px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Kanit', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--secondary-color) 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-icon {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .btn-icon:hover {
            background: var(--light-purple);
            transform: scale(1.1);
        }

        .destinations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .destination-card {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--primary-color);
        }

        .destination-info h4 {
            margin: 0 0 5px 0;
            color: var(--dark-gray);
        }

        .destination-info p {
            margin: 0 0 10px 0;
            color: var(--text-color);
            font-size: 0.9em;
        }

        .destination-actions {
            display: flex;
            gap: 10px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .role-badge.admin {
            background: var(--light-purple);
            color: var(--dark-purple);
        }

        .users-table {
            overflow-x: auto;
        }

        .users-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .users-table th,
        .users-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        .users-table th {
            background: var(--light-purple);
            color: var(--dark-purple);
            font-weight: 600;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .analytics-card {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid var(--primary-color);
        }

        .analytics-card h4 {
            margin: 0 0 15px 0;
            color: var(--dark-gray);
        }

        .chart-placeholder {
            text-align: center;
            padding: 40px;
            color: var(--dark-gray);
            opacity: 0.7;
        }

        .chart-placeholder i {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .popular-destinations {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .popular-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: 10px;
            border-left: 3px solid var(--accent-color);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .settings-card {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid var(--primary-color);
        }

        .settings-card h4 {
            margin: 0 0 20px 0;
            color: var(--dark-gray);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--medium-gray);
            border-radius: 10px;
            font-family: 'Kanit', sans-serif;
            box-sizing: border-box;
            color: var(--text-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-select {
            padding: 10px 15px;
            border: 2px solid var(--medium-gray);
            border-radius: 10px;
            background: white;
            font-family: 'Kanit', sans-serif;
            color: var(--text-color);
        }

        .data-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .admin-container {
                padding: 10px;
            }

            .logout-btn {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 20px;
            }

            .message-actions {
                flex-direction: column;
                gap: 5px;
            }

            .admin-nav {
                flex-direction: column;
            }

            .nav-tab {
                text-align: center;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .action-buttons {
                flex-direction: column;
            }

            .admin-stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>

<body>
    <div id="loginSection" class="login-form">
        <h2>เข้าสู่ระบบ Admin</h2>
        <form id="loginForm">
            <div class="form-group">
                <label for="username">ชื่อผู้ใช้:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">รหัสผ่าน:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn btn-primary login-submit-btn">เข้าสู่ระบบ</button>
            <div id="loginError" class="error-message hidden"></div>
        </form>
    </div>

    <div id="adminPanel" class="admin-panel-hidden">
        <button class="btn btn-secondary logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> ออกจากระบบ
        </button>

        <div class="admin-container">
            <div class="admin-header">
                <h1><i class="fas fa-cog"></i> Admin Panel - ที่นี่บึงกาฬ</h1>
                <p>จัดการข้อความและระบบเว็บไซต์</p>
            </div>

            <div class="admin-nav">
                <div class="nav-tab active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> แดชบอร์ด
                </div>
                <div class="nav-tab" onclick="showSection('messages')">
                    <i class="fas fa-comments"></i> ข้อความ
                </div>
                <div class="nav-tab" onclick="showSection('destinations')">
                    <i class="fas fa-map-marker-alt"></i> สถานที่
                </div>
                <div class="nav-tab" onclick="showSection('users')">
                    <i class="fas fa-users"></i> ผู้ใช้
                </div>
                <div class="nav-tab" onclick="showSection('analytics')">
                    <i class="fas fa-chart-bar"></i> สถิติ
                </div>
                <div class="nav-tab" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> ตั้งค่า
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboardSection" class="admin-section">
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-comments"></i></div>
                        <div class="stat-number" id="totalMessages">0</div>
                        <div>ข้อความทั้งหมด</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-envelope"></i></div>
                        <div class="stat-number" id="newMessages">0</div>
                        <div>ข้อความใหม่</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-day"></i></div>
                        <div class="stat-number" id="todayMessages">0</div>
                        <div>ข้อความวันนี้</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-map-marker-alt"></i></div>
                        <div class="stat-number" id="totalDestinations">40</div>
                        <div>สถานที่ทั้งหมด</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-eye"></i></div>
                        <div class="stat-number" id="totalViews">1,234</div>
                        <div>ผู้เข้าชมวันนี้</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-server"></i></div>
                        <div class="stat-number" id="systemStatus">
                            <span style="color: #27ae60;">●</span>
                        </div>
                        <div>สถานะระบบ</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3><i class="fas fa-bolt"></i> การดำเนินการด่วน</h3>
                    <div class="action-buttons">
                        <button type="button" class="btn btn-primary" onclick="showSection('messages')">
                            <i class="fas fa-comments"></i> ดูข้อความใหม่
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="exportData()">
                            <i class="fas fa-download"></i> ส่งออกข้อมูล
                        </button>
                        <button type="button" class="btn btn-accent" onclick="clearCache()">
                            <i class="fas fa-trash"></i> ล้างแคช
                        </button>
                        <button type="button" class="btn btn-warning" onclick="backupData()">
                            <i class="fas fa-save"></i> สำรองข้อมูล
                        </button>
                    </div>
                </div>
            </div>

            <!-- Messages Section -->
            <div id="messagesSection" class="admin-section hidden">
                <div class="section-header">
                    <h2><i class="fas fa-comments"></i> ข้อความจากผู้ใช้</h2>
                    <div class="section-actions">
                        <button type="button" class="btn btn-primary" onclick="refreshMessages()">
                            <i class="fas fa-sync"></i> รีเฟรช
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="markAllAsRead()">
                            <i class="fas fa-check-double"></i> อ่านทั้งหมด
                        </button>
                    </div>
                </div>
                <div id="messagesList">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>ยังไม่มีข้อความ</p>
                    </div>
                </div>
            </div>

            <!-- Destinations Section -->
            <div id="destinationsSection" class="admin-section hidden">
                <div class="section-header">
                    <h2><i class="fas fa-map-marker-alt"></i> จัดการสถานที่ท่องเที่ยว</h2>
                    <div class="section-actions">
                        <button type="button" class="btn btn-primary" onclick="addDestination()">
                            <i class="fas fa-plus"></i> เพิ่มสถานที่
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="importDestinations()">
                            <i class="fas fa-upload"></i> นำเข้าข้อมูล
                        </button>
                    </div>
                </div>
                <div class="destinations-grid" id="destinationsGrid">
                    <div class="destination-card">
                        <div class="destination-info">
                            <h4>วัดพระธาตุบึงพลาญชัย</h4>
                            <p>สถานที่ท่องเที่ยว • 4.5 ⭐</p>
                            <span class="status-badge active">เปิดใช้งาน</span>
                        </div>
                        <div class="destination-actions">
                            <button type="button" class="btn-icon" title="แก้ไข">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button type="button" class="btn-icon" title="ลบ">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="usersSection" class="admin-section hidden">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> จัดการผู้ใช้</h2>
                    <div class="section-actions">
                        <button type="button" class="btn btn-primary" onclick="addUser()">
                            <i class="fas fa-user-plus"></i> เพิ่มผู้ใช้
                        </button>
                    </div>
                </div>
                <div class="users-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ชื่อผู้ใช้</th>
                                <th>อีเมล</th>
                                <th>บทบาท</th>
                                <th>สถานะ</th>
                                <th>การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td>admin</td>
                                <td>admin@buengkan.com</td>
                                <td><span class="role-badge admin">ผู้ดูแลระบบ</span></td>
                                <td><span class="status-badge active">ใช้งาน</span></td>
                                <td>
                                    <button type="button" class="btn-icon" title="แก้ไข">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analyticsSection" class="admin-section hidden">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> สถิติและการวิเคราะห์</h2>
                    <div class="section-actions">
                        <select class="form-select" id="analyticsTimeRange">
                            <option value="today">วันนี้</option>
                            <option value="week">สัปดาห์นี้</option>
                            <option value="month" selected>เดือนนี้</option>
                            <option value="year">ปีนี้</option>
                        </select>
                    </div>
                </div>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h4>ผู้เข้าชมเว็บไซต์</h4>
                        <div class="chart-placeholder">
                            <i class="fas fa-chart-line"></i>
                            <p>กราฟแสดงจำนวนผู้เข้าชม</p>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h4>สถานที่ยอดนิยม</h4>
                        <div class="popular-destinations">
                            <div class="popular-item">
                                <span>1. วัดพระธาตุบึงพลาญชัย</span>
                                <span>245 views</span>
                            </div>
                            <div class="popular-item">
                                <span>2. ภูวัว</span>
                                <span>198 views</span>
                            </div>
                            <div class="popular-item">
                                <span>3. น้ำตกธารโตน</span>
                                <span>156 views</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="admin-section hidden">
                <div class="section-header">
                    <h2><i class="fas fa-cog"></i> ตั้งค่าระบบ</h2>
                </div>
                <div class="settings-grid">
                    <div class="settings-card">
                        <h4><i class="fas fa-globe"></i> ตั้งค่าเว็บไซต์</h4>
                        <div class="form-group">
                            <label>ชื่อเว็บไซต์:</label>
                            <input type="text" value="ที่นี่บึงกาฬ" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>คำอธิบายเว็บไซต์:</label>
                            <textarea class="form-control">แหล่งท่องเที่ยวและข้อมูลครบครันของจังหวัดบึงกาฬ</textarea>
                        </div>
                        <button type="button" class="btn btn-primary">บันทึก</button>
                    </div>
                    <div class="settings-card">
                        <h4><i class="fas fa-key"></i> ตั้งค่าความปลอดภัย</h4>
                        <div class="form-group">
                            <label>เปลี่ยนรหัสผ่าน Admin:</label>
                            <input type="password" placeholder="รหัสผ่านใหม่" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>ยืนยันรหัสผ่าน:</label>
                            <input type="password" placeholder="ยืนยันรหัสผ่านใหม่" class="form-control">
                        </div>
                        <button type="button" class="btn btn-warning">เปลี่ยนรหัสผ่าน</button>
                    </div>
                    <div class="settings-card">
                        <h4><i class="fas fa-database"></i> จัดการข้อมูล</h4>
                        <div class="data-actions">
                            <button type="button" class="btn btn-secondary">
                                <i class="fas fa-download"></i> ส่งออกข้อมูลทั้งหมด
                            </button>
                            <button type="button" class="btn btn-warning">
                                <i class="fas fa-trash"></i> ล้างข้อมูลเก่า
                            </button>
                            <button type="button" class="btn btn-danger">
                                <i class="fas fa-exclamation-triangle"></i> รีเซ็ตระบบ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ข้อมูล Admin
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'buengkan2025'
        };

        // ตรวจสอบสถานะการเข้าสู่ระบบ
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                showAdminPanel();
            }
            loadMessages();
        });

        // Navigation functions
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.admin-section');
            sections.forEach(section => section.classList.add('hidden'));

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }

            // Add active class to clicked tab
            event.target.classList.add('active');

            // Load section-specific data
            switch (sectionName) {
                case 'messages':
                    loadMessages();
                    break;
                case 'destinations':
                    loadDestinations();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        // Quick action functions
        function exportData() {
            const data = {
                messages: JSON.parse(localStorage.getItem('chatMessages') || '[]'),
                timestamp: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `buengkan-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('ส่งออกข้อมูลเรียบร้อยแล้ว');
        }

        function clearCache() {
            if (confirm('คุณต้องการล้างแคชทั้งหมดหรือไม่?')) {
                localStorage.removeItem('weatherCache');
                localStorage.removeItem('destinationsCache');
                alert('ล้างแคชเรียบร้อยแล้ว');
            }
        }

        function backupData() {
            const backupData = {
                messages: JSON.parse(localStorage.getItem('chatMessages') || '[]'),
                settings: JSON.parse(localStorage.getItem('adminSettings') || '{}'),
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('dataBackup', JSON.stringify(backupData));
            alert('สำรองข้อมูลเรียบร้อยแล้ว');
        }

        // Message management functions
        function refreshMessages() {
            loadMessages();
            updateStats();
            alert('รีเฟรชข้อมูลเรียบร้อยแล้ว');
        }

        function markAllAsRead() {
            if (confirm('คุณต้องการทำเครื่องหมายข้อความทั้งหมดว่าอ่านแล้วหรือไม่?')) {
                const messages = JSON.parse(localStorage.getItem('contactMessages') || '[]');
                messages.forEach(message => message.status = 'read');
                localStorage.setItem('contactMessages', JSON.stringify(messages));
                loadMessages();
                updateStats();
                alert('ทำเครื่องหมายข้อความทั้งหมดเรียบร้อยแล้ว');
            }
        }

        // Destination management functions
        async function loadDestinations() {
            try {
                // ดึงข้อมูลจาก API
                const response = await fetch('/api/destinations');
                if (response.ok) {
                    const destinations = await response.json();
                    displayDestinations(destinations);

                    // อัปเดตจำนวนสถานที่ในสถิติ
                    document.getElementById('totalDestinations').textContent = destinations.length;
                    return;
                }
            } catch (error) {
                console.log('API not available, showing empty state');
            }

            // หากไม่สามารถดึงข้อมูลได้
            const grid = document.getElementById('destinationsGrid');
            grid.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-map-marker-alt"></i>
                    <p>ไม่สามารถโหลดข้อมูลสถานที่ได้</p>
                    <p>กรุณาตรวจสอบการเชื่อมต่อฐานข้อมูล</p>
                </div>
            `;
        }

        function displayDestinations(destinations) {
            const grid = document.getElementById('destinationsGrid');

            if (destinations.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-map-marker-alt"></i>
                        <p>ยังไม่มีข้อมูลสถานที่</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = destinations.map(dest => `
                <div class="destination-card">
                    <div class="destination-info">
                        <h4>${dest.title || dest.name}</h4>
                        <p>${getCategoryName(dest.category)} • ${dest.rating || 'N/A'} ⭐</p>
                        <span class="status-badge active">เปิดใช้งาน</span>
                        <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                            ${dest.address ? dest.address.substring(0, 50) + '...' : 'ไม่มีที่อยู่'}
                        </div>
                    </div>
                    <div class="destination-actions">
                        <button type="button" class="btn-icon" title="แก้ไข" onclick="editDestination(${dest.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button type="button" class="btn-icon" title="ดูรายละเอียด" onclick="viewDestination(${dest.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button type="button" class="btn-icon" title="ลบ" onclick="deleteDestination(${dest.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getCategoryName(category) {
            const categories = {
                'attraction': 'สถานที่ท่องเที่ยว',
                'cafe': 'คาเฟ่',
                'accommodation': 'ที่พัก',
                'restaurant': 'ร้านอาหาร'
            };
            return categories[category] || category;
        }

        function addDestination() {
            alert('ฟีเจอร์เพิ่มสถานที่ใหม่ - จะพัฒนาในเวอร์ชันถัดไป');
        }

        function editDestination(id) {
            alert(`แก้ไขสถานที่ ID: ${id} - จะพัฒนาในเวอร์ชันถัดไป`);
        }

        function deleteDestination(id) {
            if (confirm('คุณต้องการลบสถานที่นี้หรือไม่?')) {
                alert(`ลบสถานที่ ID: ${id} - จะพัฒนาในเวอร์ชันถัดไป`);
            }
        }

        function importDestinations() {
            alert('ฟีเจอร์นำเข้าข้อมูล - จะพัฒนาในเวอร์ชันถัดไป');
        }

        // User management functions
        function addUser() {
            alert('ฟีเจอร์เพิ่มผู้ใช้ใหม่ - จะพัฒนาในเวอร์ชันถัดไป');
        }

        // Analytics functions
        function loadAnalytics() {
            // Mock analytics data
            const timeRange = document.getElementById('analyticsTimeRange').value;
            console.log(`Loading analytics for: ${timeRange}`);
            // In real app, this would fetch actual analytics data
        }

        // Update stats with mock data
        function updateStatsWithMockData() {
            document.getElementById('totalViews').textContent = Math.floor(Math.random() * 2000) + 500;
            document.getElementById('totalDestinations').textContent = '40';
        }

        // ฟังก์ชันเข้าสู่ระบบ
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');

            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                localStorage.setItem('adminLoggedIn', 'true');
                showAdminPanel();
                errorDiv.classList.add('hidden');
            } else {
                errorDiv.textContent = 'ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง';
                errorDiv.classList.remove('hidden');
            }
        });

        // แสดงหน้า Admin Panel
        function showAdminPanel() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('admin-panel-hidden');
            loadMessages();
            updateStats();
        }

        // ออกจากระบบ
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('admin-panel-hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // โหลดข้อความ
        async function loadMessages() {
            try {
                // ลองดึงจาก API ก่อน
                const response = await fetch('/api/contact');
                if (response.ok) {
                    const messages = await response.json();
                    displayMessages(messages, 'created_at');
                    return;
                }
            } catch (error) {
                console.log('API not available, using localStorage');
            }

            // ใช้ localStorage เป็น fallback
            const messages = JSON.parse(localStorage.getItem('contactMessages') || '[]');
            displayMessages(messages, 'timestamp');
        }

        function displayMessages(messages, dateField) {
            const messagesList = document.getElementById('messagesList');

            if (messages.length === 0) {
                messagesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>ยังไม่มีข้อความ</p>
                    </div>
                `;
                return;
            }

            messagesList.innerHTML = messages.map(message => `
                <div class="message-item">
                    <div class="message-content">
                        <div class="message-meta">
                            <strong>${message.name}</strong> - ${message.email} - ${formatDate(message[dateField])}
                            <span class="status-${message.status || 'new'}">${message.status === 'read' ? 'อ่านแล้ว' : 'ใหม่'}</span>
                        </div>
                        <div class="message-text">${message.message}</div>
                        <div class="message-actions">
                            <button type="button" class="btn btn-primary btn-small" onclick="markAsRead('${message.id}')">
                                <i class="fas fa-check"></i> ทำเครื่องหมายว่าอ่านแล้ว
                            </button>
                            <button type="button" class="btn btn-secondary btn-small" onclick="deleteMessage('${message.id}')">
                                <i class="fas fa-trash"></i> ลบ
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // อัปเดตสถิติ
        async function updateStats() {
            try {
                // ลองดึงจาก API ก่อน
                const response = await fetch('/api/contact');
                if (response.ok) {
                    const messages = await response.json();
                    updateStatsFromData(messages, 'created_at');
                    return;
                }
            } catch (error) {
                console.log('API not available, using localStorage for stats');
            }

            // ใช้ localStorage เป็น fallback
            const messages = JSON.parse(localStorage.getItem('contactMessages') || '[]');
            updateStatsFromData(messages, 'timestamp');
        }

        function updateStatsFromData(messages, dateField) {
            const today = new Date().toDateString();

            const totalMessages = messages.length;
            const newMessages = messages.filter(m => m.status !== 'read').length;
            const todayMessages = messages.filter(m => new Date(m[dateField]).toDateString() === today).length;

            document.getElementById('totalMessages').textContent = totalMessages;
            document.getElementById('newMessages').textContent = newMessages;
            document.getElementById('todayMessages').textContent = todayMessages;
        }

        // ทำเครื่องหมายว่าอ่านแล้ว
        async function markAsRead(messageId) {
            try {
                const response = await fetch(`/api/contact/${messageId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status: 'read' })
                });

                if (response.ok) {
                    loadMessages();
                    updateStats();
                    return;
                }
            } catch (error) {
                console.log('API not available, using localStorage');
            }

            // Fallback to localStorage
            const messages = JSON.parse(localStorage.getItem('contactMessages') || '[]');
            const messageIndex = messages.findIndex(m => m.id === messageId.toString());

            if (messageIndex !== -1) {
                messages[messageIndex].status = 'read';
                localStorage.setItem('contactMessages', JSON.stringify(messages));
                loadMessages();
                updateStats();
                alert('ทำเครื่องหมายว่าอ่านแล้วเรียบร้อย');
            }
        }

        // ลบข้อความ
        async function deleteMessage(messageId) {
            if (confirm('คุณต้องการลบข้อความนี้หรือไม่?')) {
                try {
                    const response = await fetch(`/api/contact/${messageId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        loadMessages();
                        updateStats();
                        return;
                    }
                } catch (error) {
                    console.log('API not available, using localStorage');
                }

                // Fallback to localStorage
                const messages = JSON.parse(localStorage.getItem('contactMessages') || '[]');
                const filteredMessages = messages.filter(m => m.id !== messageId.toString());
                localStorage.setItem('contactMessages', JSON.stringify(filteredMessages));
                loadMessages();
                updateStats();
                alert('ลบข้อความเรียบร้อยแล้ว');
            }
        }

        // เพิ่มฟังก์ชันดูรายละเอียดสถานที่
        function viewDestination(id) {
            alert(`ดูรายละเอียดสถานที่ ID: ${id} - จะพัฒนาในเวอร์ชันถัดไป`);
        }

        // จัดรูปแบบวันที่
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // รีเฟรชข้อมูลทุก 30 วินาที
        setInterval(() => {
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                loadMessages();
                updateStats();
                updateStatsWithMockData();
            }
        }, 30000);

        // Initialize mock data on load
        document.addEventListener('DOMContentLoaded', () => {
            updateStatsWithMockData();
        });
    </script>
</body>

</html>